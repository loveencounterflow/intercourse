{
  "version": 3,
  "file": "main.js",
  "sourceRoot": "..",
  "sources": [
    "src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n'use strict'\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'INTERCOURSE/MAIN'\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\ninfo                      = CND.get_logger 'info',      badge\nurge                      = CND.get_logger 'urge',      badge\nhelp                      = CND.get_logger 'help',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\nPATH                      = require 'path'\nPD                        = require 'pipedreams'\n{ $\n  $async\n  select }                = PD\n{ assign\n  jr }                    = CND\ncopy                      = ( x ) -> assign {}, x\n\n#-----------------------------------------------------------------------------------------------------------\ncollapse_text = ( list_of_texts ) ->\n  R = list_of_texts\n  R = R.join '\\n'\n  R = R.replace /^\\s*/, ''\n  R = R.replace /\\s*$/, ''\n  R = R + '\\n' unless R.length is 0\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\nhas_full_signatures = ( entry ) ->\n  for k of entry\n    return true if k.startsWith '('\n  return false\n\n#-----------------------------------------------------------------------------------------------------------\n@$as_line_datoms = ( S ) ->\n  line_nr = 0\n  return $ ( line, send ) ->\n    line_nr += +1\n    d           = PD.new_event '^line', line, $: { line_nr, }\n    d.is_blank  = true if ( d.value.match /^\\s*$/ )?\n    send d\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$skip_comments = ( S ) -> PD.$filter ( d ) -> not ( d.value.match S.comments )?\n\n#-----------------------------------------------------------------------------------------------------------\n@$add_headers = ( S ) ->\n  header_sig_re   = /// ^ (?<ictype> \\S+ ) \\s+ (?<icname> \\S+? )(?<signature> \\( .*? \\) ) \\s* : \\s* (?<trailer> .*? ) \\s* $ ///\n  header_plain_re = /// ^ (?<ictype> \\S+ ) \\s+ (?<icname> \\S+  )                          \\s* : \\s* (?<trailer> .*? ) \\s* $ ///\n  ignore_re       = /// ^ ignore \\s* : \\s*  $ ///\n  return $ ( d, send ) =>\n    return send d if d.is_blank\n    return send d if ( d.value.match /^\\s/ )?\n    return send PD.new_event '^ignore',     ( copy m.groups ), $: d if ( m = d.value.match ignore_re       )?\n    return send PD.new_event '^definition', ( copy m.groups ), $: d if ( m = d.value.match header_sig_re   )?\n    return send PD.new_event '^definition', ( copy m.groups ), $: d if ( m = d.value.match header_plain_re )?\n    #.......................................................................................................\n    throw new Error \"µ83473 illegal line #{rpr d}\"\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$add_regions = ( S ) ->\n  within_region = false\n  prv_name      = null\n  last          = Symbol 'last'\n  #.........................................................................................................\n  return $ { last, }, ( d, send ) =>\n    #.......................................................................................................\n    if d is last\n      if prv_name?\n        send PD.new_event '>' + prv_name\n        prv_name = null\n      return\n    #.......................................................................................................\n    if select d, '^line'\n      return send d if within_region\n      return if d.is_blank\n      throw new Error \"µ85818 found line outside of any region: #{rpr d}\"\n    #.......................................................................................................\n    if prv_name?\n      send PD.new_event '>' + prv_name\n      within_region = false\n      prv_name      = null\n    #.......................................................................................................\n    unless within_region\n      ### TAINT use PipeDreams API for this ###\n      d             = CND.deep_copy d\n      prv_name      = d.key[ 1 .. ]\n      d.key         = '<' + prv_name\n      within_region = true\n      send d\n    #.......................................................................................................\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$skip_ignored = ( S ) ->\n  within_ignore = false\n  return $ ( d, send ) =>\n    if      select d, '<ignore'   then within_ignore = true\n    else if select d, '>ignore'   then within_ignore = false\n    else unless within_ignore     then send d\n    #.......................................................................................................\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$reorder_trailers = ( S ) ->\n  within_definition = false\n  is_oneliner       = false\n  return $ ( d, send ) =>\n    #.......................................................................................................\n    if select d, '<definition'\n      within_definition = true\n      trailer           = d.value.trailer\n      delete d.value.trailer\n      if trailer? and ( trailer.length > 0 )\n        is_oneliner = true\n        send d\n        send PD.new_event '^line', '  ' + trailer.trim(), $: d\n      else\n        send d\n    #.......................................................................................................\n    else if select d, '>definition'\n      is_oneliner       = false\n      within_definition = false\n      send d\n    #.......................................................................................................\n    else if within_definition and is_oneliner and ( not select d, '>definition' ) and not d.is_blank\n      throw new Error \"µ87872 illegal follow-up after one-liner: #{rpr d}\"\n    #.......................................................................................................\n    else\n      send d\n    #.......................................................................................................\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$compile_definitions = ( S ) ->\n  this_definition   = null\n  this_indentation  = null\n  #.........................................................................................................\n  return $ ( d, send ) =>\n    #.......................................................................................................\n    if select d, '<definition'\n      name                = d.value.icname\n      type                = d.value.ictype\n      location            = d.$\n      signature           = null\n      this_definition     = { name, type, text: [], location, kenning: 'null', }\n      if d.value.signature?\n        signature = []\n        for argument in ( d.value.signature.replace /[()]/g, '' ).split ','\n          signature.push argument if ( argument = argument.trim() )? and argument.length > 0\n        signature.sort()\n        this_definition.signature = signature\n        this_definition.kenning   = '(' + ( signature.join ',' ) + ')'\n    #.......................................................................................................\n    else if select d, '>definition'\n      this_definition.text  = collapse_text this_definition.text\n      send PD.new_event '^definition', this_definition, $: this_definition.location\n      this_definition       = null\n      this_indentation      = null\n    #.......................................................................................................\n    else if select d, '^line'\n      return this_definition.text.push '' if d.is_blank\n      text = d.value\n      #.....................................................................................................\n      unless this_indentation?\n        unless ( match = text.match /^\\s+/ )?\n          throw new Error \"µ88163 unexpected indentation: #{rpr d}\"\n        this_indentation = match[ 0 ]\n      #.....................................................................................................\n      else\n        unless text.startsWith this_indentation\n          throw new Error \"µ90508 unexpected indentation: #{rpr d}\"\n      #.....................................................................................................\n      text = text[ this_indentation.length .. ]\n      this_definition.text.push text\n    #.......................................................................................................\n    else\n      throw new Error \"µ92853 unexpected datom: #{rpr d}\"\n    #.......................................................................................................\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$collect = ( S, collector ) ->\n  return $ ( d, send ) =>\n    unless select d, '^definition'\n      throw new Error \"µ23982 expected a '^definition', got #{rpr d}\"\n    #.......................................................................................................\n    lnr                 = d.$.line_nr\n    definition          = d.value\n    { type\n      text\n      location\n      kenning\n      signature }       = definition\n    entry               = ( collector[ definition.name ] ?= { type, } )\n    #.......................................................................................................\n    unless d.value.type is entry.type\n      throw new Error \"\"\"µ94432\n        expected type #{rpr entry.type}, got\n        #{rpr definition.type}\n        (line ##{lnr})\"\"\"\n    #.......................................................................................................\n    if entry[ kenning ]?\n      throw new Error \"\"\"µ23983\n        name #{definition.name} with kenning #{rpr kenning} already defined:\n        #{rpr definition}\n        (line ##{lnr})\"\"\"\n    #.......................................................................................................\n    ### TAINT must re-implement ###\n    if ( kenning is 'null' ) and ( has_full_signatures entry )\n      debug entry\n      throw new Error \"\"\"µ23983\n        can't overload explicit-signature definition with a null-signature definition:\n        #{rpr definition}\n        (line ##{lnr})\"\"\"\n    #.......................................................................................................\n    entry[ kenning ]            = { text, location, kenning, type, }\n    entry[ kenning ].signature  = signature if signature?\n    #.......................................................................................................\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@read_definitions           = ( path ) -> await @_read_definitions PD.read_from_file path\n@read_definitions_from_text = ( text ) -> await @_read_definitions PD.new_value_source [ text, ]\n\n#-----------------------------------------------------------------------------------------------------------\n@_read_definitions = ( source ) ->\n  return new Promise ( resolve, reject ) =>\n    R         = {}\n    S         = { comments: /^--/, }\n    pipeline  = []\n    pipeline.push source\n    pipeline.push PD.$split()\n    pipeline.push @$as_line_datoms        S\n    pipeline.push @$skip_comments         S\n    pipeline.push @$add_headers           S\n    pipeline.push @$add_regions           S\n    pipeline.push @$skip_ignored          S\n    pipeline.push @$reorder_trailers      S\n    pipeline.push @$compile_definitions   S\n    pipeline.push @$collect               S, R\n    pipeline.push PD.$drain -> resolve R\n    PD.pull pipeline...\n    return null\n\n\n\n\n"
  ]
}